import datetime
from typing import TYPE_CHECKING

import attr

from bungio.models.base import BaseEnum, BaseModel

if TYPE_CHECKING:
    from bungio.models import ApplicationDeveloper, Datapoint, Series, UserInfoCard


class ApplicationScopes(BaseEnum):
    """
    _No description given_
    """

    READ_BASIC_USER_PROFILE = 1
    """Read basic user profile information such as the user's handle, avatar icon, etc. """
    READ_GROUPS = 2
    """Read Group/Clan Forums, Wall, and Members for groups and clans that the user has joined. """
    WRITE_GROUPS = 4
    """Write Group/Clan Forums, Wall, and Members for groups and clans that the user has joined. """
    ADMIN_GROUPS = 8
    """Administer Group/Clan Forums, Wall, and Members for groups and clans that the user is a founder or an administrator. """
    BNET_WRITE = 16
    """Create new groups, clans, and forum posts, along with other actions that are reserved for Bungie.net elevated scope: not meant to be used by third party applications. """
    MOVE_EQUIP_DESTINY_ITEMS = 32
    """Move or equip Destiny items """
    READ_DESTINY_INVENTORY_AND_VAULT = 64
    """Read Destiny 1 Inventory and Vault contents. For Destiny 2, this scope is needed to read anything regarded as private. This is the only scope a Destiny 2 app needs for read operations against Destiny 2 data such as inventory, vault, currency, vendors, milestones, progression, etc. """
    READ_USER_DATA = 128
    """Read user data such as who they are web notifications, clan/group memberships, recent activity, muted users. """
    EDIT_USER_DATA = 256
    """Edit user data such as preferred language, status, motto, avatar selection and theme. """
    READ_DESTINY_VENDORS_AND_ADVISORS = 512
    """Access vendor and advisor data specific to a user. OBSOLETE. This scope is only used on the Destiny 1 API. """
    READ_AND_APPLY_TOKENS = 1024
    """Read offer history and claim and apply tokens for the user. """
    ADVANCED_WRITE_ACTIONS = 2048
    """Can perform actions that will result in a prompt to the user via the Destiny app. """
    PARTNER_OFFER_GRANT = 4096
    """Can user the partner offer api to claim rewards defined for a partner """
    DESTINY_UNLOCK_VALUE_QUERY = 8192
    """Allows an app to query sensitive information like unlock flags and values not available through normal methods. """
    USER_PII_READ = 16384
    """Allows an app to query sensitive user PII, most notably email information. """


@attr.define
class ApiUsage(BaseModel):
    """
    _No description given_

    Attributes:
        api_calls: Counts for on API calls made for the time range.
        throttled_requests: Instances of blocked requests or requests that crossed the warn threshold during the time range.
    """

    api_calls: list["Series"] = attr.field()
    throttled_requests: list["Series"] = attr.field()


@attr.define
class Series(BaseModel):
    """
    _No description given_

    Attributes:
        datapoints: Collection of samples with time and value.
        target: Target to which to datapoints apply.
    """

    datapoints: list["Datapoint"] = attr.field()
    target: str = attr.field()


@attr.define
class Datapoint(BaseModel):
    """
    _No description given_

    Attributes:
        time: Timestamp for the related count.
        count: Count associated with timestamp
    """

    time: datetime.datetime = attr.field()
    count: float = attr.field()


@attr.define
class Application(BaseModel):
    """
    _No description given_

    Attributes:
        application_id: Unique ID assigned to the application
        name: Name of the application
        redirect_url: URL used to pass the user's authorization code to the application
        link: Link to website for the application where a user can learn more about the app.
        scope: Permissions the application needs to work
        origin: Value of the Origin header sent in requests generated by this application.
        status: Current status of the application.
        creation_date: Date the application was first added to our database.
        status_changed: Date the application status last changed.
        first_published: Date the first time the application status entered the 'Public' status.
        team: List of team members who manage this application on Bungie.net. Will always consist of at least the application owner.
        override_authorize_view_name: An optional override for the Authorize view name.
    """

    application_id: int = attr.field()
    name: str = attr.field()
    redirect_url: str = attr.field()
    link: str = attr.field()
    scope: int = attr.field()
    origin: str = attr.field()
    status: int = attr.field()
    creation_date: datetime.datetime = attr.field()
    status_changed: datetime.datetime = attr.field()
    first_published: datetime.datetime = attr.field()
    team: list["ApplicationDeveloper"] = attr.field()
    override_authorize_view_name: str = attr.field()


class ApplicationStatus(BaseEnum):
    """
    _No description given_
    """

    NONE = 0
    """No value assigned """
    PRIVATE = 1
    """Application exists and works but will not appear in any public catalog. New applications start in this state, test applications will remain in this state. """
    PUBLIC = 2
    """Active applications that can appear in an catalog. """
    DISABLED = 3
    """Application disabled by the owner. All authorizations will be treated as terminated while in this state. Owner can move back to private or public state. """
    BLOCKED = 4
    """Application has been blocked by Bungie. It cannot be transitioned out of this state by the owner. Authorizations are terminated when an application is in this state. """


@attr.define
class ApplicationDeveloper(BaseModel):
    """
    _No description given_

    Attributes:
        role: _No description given_
        api_eula_version: _No description given_
        user: _No description given_
    """

    role: int = attr.field()
    api_eula_version: int = attr.field()
    user: "UserInfoCard" = attr.field()


class DeveloperRole(BaseEnum):
    """
    _No description given_
    """

    NONE = 0
    """_No description given_ """
    OWNER = 1
    """_No description given_ """
    TEAM_MEMBER = 2
    """_No description given_ """
